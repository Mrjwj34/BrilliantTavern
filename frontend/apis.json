{
  "openapi": "3.0.1",
  "info": {
    "title": "BrilliantTavern API",
    "description": "BrilliantTavern AI角色扮演聊天平台API文档",
    "license": {
      "name": "MIT License"
    },
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "http://localhost:8080/api",
      "description": "Generated server url"
    }
  ],
  "security": [
    {
      "bearer-key": []
    }
  ],
  "tags": [
    {
      "name": "认证管理",
      "description": "用户注册、登录、登出相关接口"
    },
    {
      "name": "测试接口",
      "description": "用于测试系统功能的接口"
    },
    {
      "name": "角色卡管理",
      "description": "角色卡的创建、修改、删除、查询和点赞功能"
    }
  ],
  "paths": {
    "/api/character-cards/{cardId}": {
      "get": {
        "tags": [
          "角色卡管理"
        ],
        "summary": "获取角色卡详情",
        "description": "根据ID获取角色卡的详细信息",
        "operationId": "getCharacterCard",
        "parameters": [
          {
            "name": "cardId",
            "in": "path",
            "description": "角色卡ID",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseCharacterCardResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": [
          "角色卡管理"
        ],
        "summary": "更新角色卡",
        "description": "用户更新自己创建的角色卡信息",
        "operationId": "updateCharacterCard",
        "parameters": [
          {
            "name": "cardId",
            "in": "path",
            "description": "角色卡ID",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCharacterCardRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseCharacterCardResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "角色卡管理"
        ],
        "summary": "删除角色卡",
        "description": "用户删除自己创建的角色卡",
        "operationId": "deleteCharacterCard",
        "parameters": [
          {
            "name": "cardId",
            "in": "path",
            "description": "角色卡ID",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseVoid"
                }
              }
            }
          }
        }
      }
    },
    "/auth/register": {
      "post": {
        "tags": [
          "认证管理"
        ],
        "summary": "用户注册",
        "description": "创建新用户账户",
        "operationId": "register",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegisterRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseJwtResponse"
                }
              }
            }
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "tags": [
          "认证管理"
        ],
        "summary": "用户登出",
        "description": "用户登出（主要在前端清除token）",
        "operationId": "logout",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseString"
                }
              }
            }
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "tags": [
          "认证管理"
        ],
        "summary": "用户登录",
        "description": "用户身份验证，返回JWT令牌",
        "operationId": "login",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseJwtResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/character-cards": {
      "post": {
        "tags": [
          "角色卡管理"
        ],
        "summary": "创建角色卡",
        "description": "用户创建一个新的角色卡",
        "operationId": "createCharacterCard",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCharacterCardRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseCharacterCardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/character-cards/{cardId}/like": {
      "post": {
        "tags": [
          "角色卡管理"
        ],
        "summary": "点赞/取消点赞角色卡",
        "description": "切换角色卡的点赞状态",
        "operationId": "toggleLike",
        "parameters": [
          {
            "name": "cardId",
            "in": "path",
            "description": "角色卡ID",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseBoolean"
                }
              }
            }
          }
        }
      }
    },
    "/test/public": {
      "get": {
        "tags": [
          "测试接口"
        ],
        "summary": "公开接口测试",
        "description": "测试无需认证的公开接口",
        "operationId": "publicEndpoint",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseString"
                }
              }
            }
          }
        }
      }
    },
    "/test/profile": {
      "get": {
        "tags": [
          "测试接口"
        ],
        "summary": "获取用户信息",
        "description": "测试用户认证状态，获取当前登录用户信息",
        "operationId": "getProfile",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponseMapStringObject"
                }
              }
            }
          }
        }
      }
    },
    "/api/character-cards/user/{userId}": {
      "get": {
        "tags": [
          "角色卡管理"
        ],
        "summary": "获取指定用户的角色卡",
        "description": "获取指定用户创建的所有公开角色卡",
        "operationId": "getUserCharacterCards",
        "parameters": [
          {
            "name": "userId",
            "in": "path",
            "description": "用户ID",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          },
          {
            "name": "page",
            "in": "query",
            "description": "页码，从0开始",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "每页数量",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponsePageCharacterCardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/character-cards/search": {
      "get": {
        "tags": [
          "角色卡管理"
        ],
        "summary": "搜索公开角色卡",
        "description": "根据关键词搜索公开的角色卡",
        "operationId": "searchCharacterCards",
        "parameters": [
          {
            "name": "keyword",
            "in": "query",
            "description": "搜索关键词",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "page",
            "in": "query",
            "description": "页码，从0开始",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "每页数量",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponsePageCharacterCardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/character-cards/public": {
      "get": {
        "tags": [
          "角色卡管理"
        ],
        "summary": "获取公开角色卡列表",
        "description": "分页获取所有公开的角色卡，按点赞数和创建时间排序",
        "operationId": "getPublicCharacterCards",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "页码，从0开始",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "每页数量",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponsePageCharacterCardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/character-cards/popular": {
      "get": {
        "tags": [
          "角色卡管理"
        ],
        "summary": "获取热门角色卡",
        "description": "获取按点赞数排序的热门角色卡",
        "operationId": "getPopularCharacterCards",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "页码，从0开始",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "每页数量",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponsePageCharacterCardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/character-cards/my": {
      "get": {
        "tags": [
          "角色卡管理"
        ],
        "summary": "获取我的角色卡",
        "description": "获取当前用户创建的所有角色卡",
        "operationId": "getMyCharacterCards",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "页码，从0开始",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "每页数量",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponsePageCharacterCardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/character-cards/liked": {
      "get": {
        "tags": [
          "角色卡管理"
        ],
        "summary": "获取我的点赞列表",
        "description": "获取当前用户点赞的所有角色卡",
        "operationId": "getLikedCharacterCards",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "页码，从0开始",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "每页数量",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponsePageCharacterCardResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/character-cards/latest": {
      "get": {
        "tags": [
          "角色卡管理"
        ],
        "summary": "获取最新角色卡",
        "description": "获取按创建时间排序的最新角色卡",
        "operationId": "getLatestCharacterCards",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "页码，从0开始",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 0
            }
          },
          {
            "name": "size",
            "in": "query",
            "description": "每页数量",
            "required": false,
            "schema": {
              "type": "integer",
              "format": "int32",
              "default": 20
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "*/*": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResponsePageCharacterCardResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "CharacterCardDataDto": {
        "type": "object",
        "properties": {
          "description": {
            "maxLength": 5000,
            "minLength": 0,
            "type": "string"
          },
          "personality": {
            "maxLength": 2000,
            "minLength": 0,
            "type": "string"
          },
          "scenario": {
            "maxLength": 3000,
            "minLength": 0,
            "type": "string"
          },
          "exampleDialogs": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ExampleDialogDto"
            }
          },
          "customPrompts": {
            "$ref": "#/components/schemas/CustomPromptsDto"
          }
        }
      },
      "CustomPromptsDto": {
        "type": "object",
        "properties": {
          "systemPromptPrefix": {
            "maxLength": 2000,
            "minLength": 0,
            "type": "string"
          },
          "systemPromptSuffix": {
            "maxLength": 2000,
            "minLength": 0,
            "type": "string"
          }
        }
      },
      "ExampleDialogDto": {
        "type": "object",
        "properties": {
          "user": {
            "maxLength": 1000,
            "minLength": 0,
            "type": "string"
          },
          "assistant": {
            "maxLength": 1000,
            "minLength": 0,
            "type": "string"
          }
        }
      },
      "UpdateCharacterCardRequest": {
        "required": [
          "name"
        ],
        "type": "object",
        "properties": {
          "name": {
            "maxLength": 100,
            "minLength": 0,
            "type": "string"
          },
          "shortDescription": {
            "maxLength": 500,
            "minLength": 0,
            "type": "string"
          },
          "greetingMessage": {
            "maxLength": 1000,
            "minLength": 0,
            "type": "string"
          },
          "isPublic": {
            "type": "boolean"
          },
          "ttsVoiceId": {
            "maxLength": 100,
            "minLength": 0,
            "type": "string"
          },
          "cardData": {
            "$ref": "#/components/schemas/CharacterCardDataDto"
          }
        }
      },
      "ApiResponseCharacterCardResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "$ref": "#/components/schemas/CharacterCardResponse"
          },
          "timestamp": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "CharacterCardResponse": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "creatorId": {
            "type": "string",
            "format": "uuid"
          },
          "creatorUsername": {
            "type": "string"
          },
          "name": {
            "type": "string"
          },
          "shortDescription": {
            "type": "string"
          },
          "greetingMessage": {
            "type": "string"
          },
          "isPublic": {
            "type": "boolean"
          },
          "likesCount": {
            "type": "integer",
            "format": "int32"
          },
          "ttsVoiceId": {
            "type": "string"
          },
          "cardData": {
            "$ref": "#/components/schemas/CharacterCardDataDto"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "isLikedByCurrentUser": {
            "type": "boolean"
          }
        }
      },
      "RegisterRequest": {
        "required": [
          "email",
          "password",
          "username"
        ],
        "type": "object",
        "properties": {
          "username": {
            "maxLength": 50,
            "minLength": 3,
            "type": "string"
          },
          "email": {
            "type": "string"
          },
          "password": {
            "maxLength": 100,
            "minLength": 6,
            "type": "string"
          }
        }
      },
      "ApiResponseJwtResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "$ref": "#/components/schemas/JwtResponse"
          },
          "timestamp": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "JwtResponse": {
        "type": "object",
        "properties": {
          "token": {
            "type": "string"
          },
          "type": {
            "type": "string"
          },
          "userId": {
            "type": "string",
            "format": "uuid"
          },
          "username": {
            "type": "string"
          },
          "email": {
            "type": "string"
          },
          "expiresAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ApiResponseString": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "type": "string"
          },
          "timestamp": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "LoginRequest": {
        "required": [
          "password",
          "username"
        ],
        "type": "object",
        "properties": {
          "username": {
            "maxLength": 50,
            "minLength": 3,
            "type": "string"
          },
          "password": {
            "maxLength": 100,
            "minLength": 6,
            "type": "string"
          }
        }
      },
      "CreateCharacterCardRequest": {
        "required": [
          "cardData",
          "name"
        ],
        "type": "object",
        "properties": {
          "name": {
            "maxLength": 100,
            "minLength": 0,
            "type": "string",
            "description": "角色名称",
            "example": "苏格拉底"
          },
          "shortDescription": {
            "maxLength": 500,
            "minLength": 0,
            "type": "string",
            "description": "简短描述",
            "example": "古希腊哲学家，智慧的化身"
          },
          "greetingMessage": {
            "maxLength": 1000,
            "minLength": 0,
            "type": "string",
            "description": "问候语",
            "example": "你好，我是苏格拉底。让我们一起探讨智慧吧！"
          },
          "isPublic": {
            "type": "boolean",
            "description": "是否公开",
            "example": true
          },
          "ttsVoiceId": {
            "maxLength": 100,
            "minLength": 0,
            "type": "string",
            "description": "TTS音色ID",
            "example": "zh-CN-XiaoxiaoNeural"
          },
          "cardData": {
            "$ref": "#/components/schemas/CharacterCardDataDto"
          }
        },
        "description": "创建角色卡请求"
      },
      "ApiResponseBoolean": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "type": "boolean"
          },
          "timestamp": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "ApiResponseMapStringObject": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "type": "object",
            "additionalProperties": {
              "type": "object"
            }
          },
          "timestamp": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "ApiResponsePageCharacterCardResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "$ref": "#/components/schemas/PageCharacterCardResponse"
          },
          "timestamp": {
            "type": "integer",
            "format": "int64"
          }
        }
      },
      "PageCharacterCardResponse": {
        "type": "object",
        "properties": {
          "totalElements": {
            "type": "integer",
            "format": "int64"
          },
          "totalPages": {
            "type": "integer",
            "format": "int32"
          },
          "size": {
            "type": "integer",
            "format": "int32"
          },
          "content": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CharacterCardResponse"
            }
          },
          "number": {
            "type": "integer",
            "format": "int32"
          },
          "sort": {
            "$ref": "#/components/schemas/SortObject"
          },
          "first": {
            "type": "boolean"
          },
          "last": {
            "type": "boolean"
          },
          "numberOfElements": {
            "type": "integer",
            "format": "int32"
          },
          "pageable": {
            "$ref": "#/components/schemas/PageableObject"
          },
          "empty": {
            "type": "boolean"
          }
        }
      },
      "PageableObject": {
        "type": "object",
        "properties": {
          "offset": {
            "type": "integer",
            "format": "int64"
          },
          "sort": {
            "$ref": "#/components/schemas/SortObject"
          },
          "pageSize": {
            "type": "integer",
            "format": "int32"
          },
          "paged": {
            "type": "boolean"
          },
          "pageNumber": {
            "type": "integer",
            "format": "int32"
          },
          "unpaged": {
            "type": "boolean"
          }
        }
      },
      "SortObject": {
        "type": "object",
        "properties": {
          "empty": {
            "type": "boolean"
          },
          "sorted": {
            "type": "boolean"
          },
          "unsorted": {
            "type": "boolean"
          }
        }
      },
      "ApiResponseVoid": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "message": {
            "type": "string"
          },
          "data": {
            "type": "object"
          },
          "timestamp": {
            "type": "integer",
            "format": "int64"
          }
        }
      }
    },
    "securitySchemes": {
      "bearer-key": {
        "type": "http",
        "description": "JWT Token认证",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  }
}
